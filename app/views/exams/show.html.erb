<% provide(:title, 'Examination') %>
<h1><%= @exam.subject.name %></h1>
<ul class="users">
  <% @question1s.each_with_index do |question, index| %>
    <li><%= index + 1 %>. <%= question.content %></li>
    <ul>
      <%= collection_check_boxes(:exam, :answer_ids, question.answers, :id, :content) do |b|%>
        <li>
          <%= b.check_box disabled: "disabled" %>
          <%= b.text %>
        </li>            
      <% end %>
      <li>
        <% @checked = @exam.responses.with_question_id question.id %>
        <% @correct = @exam.answers.question_correct_answers question.id %>
        <% @answer_key = question.answers.correct_answers %>
        <% if @correct.size == @checked.size && @correct.size == @answer_key.size %>
          <b style="color:green">Correct answer</b>
        <% else %>
          <b style="color:red">Incorrect answer</b>
        <% end %>
      </li>
    </ul>
  <% end %>
  <% @question2s.each_with_index do |question, index| %>
    <li><%= index + @question1s.size + 1 %>. <%= question.content %></li>     
    <ul>
      <% @exam.responses.with_question_id(question.id).each do |response| %>
        <li><input value="<%= response.answer_content %>", disabled="disabled" /></li>
      <% end %>
      <% @correct = 0 
        @filled = @exam.responses.with_question_id question.id 
        @answer_key = question.answers.correct_answers 
        @filled.each_with_index do |fill, i|        
          if fill.answer_content == @answer_key[i].content
            @correct += 1
          end 
        end %>
      <li>            
        <% if @correct == @answer_key.size %>        
          <b style="color:green">Correct answer</b>
        <% else %>
          <b style="color:red">Incorrect answer</b>
        <% end %>
      </li>
    </ul>
  <% end %>
</ul>